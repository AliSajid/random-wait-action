name: 'CodeQL Analysis'

on:
    push:
        branches:
            - 'main'
            - 'next'
    pull_request:
        # The branches below must be a subset of the branches above
        branches:
            - 'main'
            - 'next'
    schedule:
        - cron: '31 19 * * 5'

permissions:
    contents: read

jobs:
    analyze:
        name: Analyze
        runs-on: ubuntu-latest
        permissions:
            security-events: write

        strategy:
            fail-fast: false
            matrix:
                language: ['TypeScript']

        steps:
            - name: Harden Runner
              uses: step-security/harden-runner@f4a75cfd619ee5ce8d5b864b0d183aff3c69b55a # v2.13.1
              with:
                  disable-sudo: true
                  egress-policy: audit
                  allowed-endpoints: >
                      api.github.com:443
                      github.com:443
                      index.crates.io:443
                      mise-versions.jdx.dev:443
                      mise.jdx.dev:443
                      nodejs.org:443
                      raw.githubusercontent.com:443
                      registry.npmjs.org:443
                      release-assets.githubusercontent.com:443
                      static.crates.io:443

            - name: Checkout repository
              uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2

            - name: Initialize CodeQL
              uses: github/codeql-action/init@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4.32.4
              with:
                  languages: ${{ matrix.language }}
                  source-root: src

            - name: Autobuild
              uses: github/codeql-action/autobuild@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4.32.4

            - name: Perform CodeQL Analysis
              uses: github/codeql-action/analyze@89a39a4e59826350b863aa6b6252a07ad50cf83e # v4.32.4
